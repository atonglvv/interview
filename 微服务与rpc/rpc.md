# 服务提供者

## 服务提供者需要将什么数据注册至服务注册中心？

**服务名称、服务版本号、服务地址、服务端口号、服务分组信息。**

服务名称：服务的名称往往是提供服务的接口的完整类名。（interfaceClass、interfaceClassName）

服务版本号：标识当前服务的版本号，以版本号的形式来区分不同版本所提供的不同服务。

服务地址： 服务提供者发布的服务所在的网络地址，往往是一个IP地址或者域名。

服务端口号： 服务提供者发布的服务所监听的端口号。

服务分组：对不同的服务进行分组，达到服务隔离的效果。

**注意：服务地址跟端口号可以配置在项目上，而不需要在服务提供者注解上。**

# 服务消费者

注册中心地址：服务消费者需要从注册中心中订阅服务提供者的信息。

注册中心的类型：由于RPC框架需要支持不同类型的注册中心，所以在服务消费者中需要配置服务的注册中心类型。

负载均衡类型：当具备多个服务提供者时，服务消费者需要实现负载均衡，在多个服务提供者中选择一个有效的服务提供者进行调用。

版本号：与服务提供者对应，只有服务名称、服务版本号、服务分组与服务提供者都匹配时才能调用到服务提供者相应的服务。

服务分组：与服务提供者对应，只有服务名称、服务版本号、服务分组与服务提供者都匹配时，才能调用到服务提供者相应的服务。

序列化类型：服务消费者调用服务提供者的服务时，数据需要在网络中进行传输，这就涉及到数据的序列化方式。

超时时间：服务消费者调用服务提供者的服务时，为避免一直阻塞，造成服务性能低下的问题，这里根据实际情况可以设置超时时间。

是否异步调用：一个较为完备的RPC框架需要在服务消费者一侧实现同步和异步调用。

是否单向调用：一个较为完备的RPC框架，需要在服务消费者一侧实现是否是单向调用。

代理方式：在服务消费者一侧需要实现根据不同的代理方式来对远程的服务提供者发起调用。

# 核心注解的扫描与解析

# 自定义网络传输协议

# 自定义网络编码解码





# 注册中心















# Question

## 我的问题

### 服务分组的作用？

### 序列化类型为什么只在消费者端设置？服务者ne？

### 消费者注解为什么不需要配置服务者的名称？

服务消费者需要调用的服务提供者发布的服务名称，是从注册中心中获取的，所以，在服务消费者中不用配置服务名称。

### 为什么要自定义传输协议与编解码？

通用的网络传输协议冗余字段太多，会造成网络通信不够高效，需要精简，传输的数据越少越好。

RPC框架作为分布式系统底层通信的基础设施框架，对其性能的要求是非常高的，需要在协议设计和编解码设计上投入比较大的精力。

通用的网络传输协议难以结合具体场景实现自定义的传输格式与传输位标识。

## 面试题

### 如何保证rpc无损？

客户端通过重试机制保证。

服务端需要做到优雅启停。

优雅停止，就是重启服务或关闭服务之前，先把该服务从注册中心删除（摘流量，下线），然后等把发送给微服务的消息处理完毕后（该台服务没有日志之后），再彻底关闭。

优雅启动，当微服务实例能够处理`rpc`请求的时候，再将实例自己注册到注册中心（上线）。避免请求发进来，实例却无法处理。
