# 对称加密？

加密和解密使用的是同一个秘钥。

# 非对称加密？

非对称加密需要用两个秘钥来进行加密和解密。

# https

## 考虑场景一：

client 跟 server用对称加密，client请求server，server返回给client一个密钥。

后面client使用该密钥进行加密解密，跟server交流。

问题：

client第一次请求server的时候，采用的是明文。如果该请求被拦截，就会造成密钥泄漏。



## 考虑场景二：

client请求server，server首先将自己的公钥发给client。

client收到公钥后，client自己也生成一个密钥k3（对称加密用）。

并且用公钥k1对自己生成的密钥k3加密，发送给server。

server使用自己的私钥k2，解开密文，获取k3。

然后 client 跟 server 通过k3进行对称加密的通信。

问题：

考虑黑客，可以截获第一次请求server发给client的公钥。

黑客可以将自己生成的公钥k4发给client。

client使用公钥k4加密自己的密钥k3。并发送给server。

请求再次被黑客截获，黑客可以使用自己的私钥k5解密client发送的内容获取k3。

这样黑客就获取到了client跟server之间的对称加密的密钥。



## 考虑场景三（https流程）：

server首先把自己的公钥K1发给证书颁发机构，向证书颁发机构申请证书。

证书颁发机构（CA机构）自己也有一对公钥**KOrgPublic**、私钥**KOrgPrivate**。CA机构利用自己的私钥**KOrgPrivate**来加密K1，并且通过服务端网址等信息生成一个证书签名，证书签名同样经过机构的私钥**KOrgPrivate**加密。证书制作完成后，机构把证书发送给了server。

当client向server请求通信的时候，server不再直接返回自己的公钥K1，而是把自己申请的证书返回给client。

client收到证书以后，要做的第一件事情是验证证书的真伪。需要说明的是，**各大浏览器和操作系统已经维护了所有权威CA机构的名称和公钥**。所以client只需要知道是哪个CA机构颁布的证书，就可以从本地找到对应的CA机构公钥**KOrgPublic**，解密出证书签名。

接下来，client按照同样的签名规则，自己也生成一个证书签名，如果两个签名一致，说明证书是有效的。

验证成功后，client就可以放心地再次利用CA机构公钥**KOrgPublic**，解密出server的公钥K1。

client用公钥k1对自己生成的密钥k3加密，发送给server。

server使用自己的私钥k2，解开密文，获取k3。

然后 client 跟 server 通过k3进行对称加密的通信。

### 黑客有可能篡改该证书吗？

假设中间人篡改了证书的原文，由于他没有CA机构的私钥，所以无法得到此时加密后签名，无法相应地篡改签名。浏览器收到该证书后会发现原文和签名解密后的值不一致，则说明证书已被篡改，从而终止向服务器传输信息。

### 黑客有可能把证书掉包吗？

假设有另一个网站B也拿到了CA机构认证的证书，它想劫持网站A的信息。于是它成为中间人拦截到了A传给浏览器的证书，然后替换成自己的证书，传给浏览器，之后浏览器就会错误地拿到B的证书里的公钥了。

其实这并不会发生，因为证书里包含了网站A的信息，包括域名，浏览器把证书里的域名与自己请求的域名比对一下就知道有没有被掉包了。



