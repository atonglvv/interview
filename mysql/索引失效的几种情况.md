# 数据库索引失效的几种情况

## 索引列使用了函数或表达式
- 如果查询条件中对索引列使用了函数、类型转换或者表达式，数据库无法直接使用索引，而是需要先计算表达式的值，然后再进行查询，这会导致索引失效。

- 例如，如果对 date_created 字段进行了函数操作，如 DATE_FORMAT(date_created, '%Y-%m-%d') = '2022-01-01'，那么索引可能会失效。

## 对索引列进行了数据类型转换

- 如果查询条件中对索引列进行了数据类型转换，数据库可能无法利用索引，导致索引失效。
- 例如，如果索引是在 age 字段上建立的，但是查询时对 age 进行了类型转换，如 CAST(age AS CHAR) = '18'，那么索引可能会失效。

## 索引列进行了隐式类型转换

- 当查询条件中对索引列进行了隐式类型转换时，数据库可能无法利用索引，导致索引失效。
- 例如，如果索引是在整数类型的 id 字段上建立的，但是查询时传入的是字符串类型的值，那么索引可能会失效。

## 对索引列运算（如，+、-、*、/）

例如，select * from table where age - 1 = 10; 

## 使用了不等于（!= 或 <>）操作符

- 对于不等于操作符，数据库通常无法利用索引进行加速查询，因为索引是按照排序顺序组织的，而不等于操作符无法利用索引的排序特性。

- 例如，SELECT * FROM table WHERE status != 'completed'，这种情况下索引可能会失效。

## 复合索引没有最左匹配

- 例如，假设存在复合索引 (a,b,c)，sql：select * from table where b = 'name' c = '18'; 这种情况因为没有匹配最左前缀，导致索引失效。

## LIKE 操作符的模糊查询

- 对于 LIKE 操作符进行的模糊查询，如果通配符放在索引列的开头，数据库无法利用索引，导致索引失效。
- 例如，SELECT * FROM table WHERE name LIKE '%keyword%'，这种情况下索引可能会失效。

## 使用 OR 连接多个条件（可能）

- 当查询条件中使用了 OR 连接多个条件时，如果其中至少一个条件无法利用索引，整个查询可能会导致索引失效。
- 例如，SELECT * FROM table WHERE status = 'completed' OR amount > 1000，这种情况下索引可能会失效。

## 使用is null， is not null（可能）

如果有两个索引（name）跟（age）。select * from table where name is not null or age is not null; 这种情况可能会索引失效。

## 左连接查询或者右连接查询查询关联的字段字符集不一致

列入，table a 关联 table b，两个表的关联字段其中一个用的utf8mb4，另一个用的utf8。这种情况会导致索引失效。
